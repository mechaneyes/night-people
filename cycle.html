<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Instagram - Cycling through #bmx</title>
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js">
		</script>
		<!-- <link rel="stylesheet" type="text/css" href="http://reset5.googlecode.com/hg/reset.min.css"> -->
	</head>
	<style type="text/css">
		#target ul {position:relative;}
		#target li {position:absolute;z-index:1}
		#target li.active {z-index:3}
		li {list-style-type: none;}
	</style>
<body>



<div id="target">
	<ul>
		<li class="active"><img src="http://scontent-a.cdninstagram.com/hphotos-xaf1/t51.2885-15/10832005_1759608374263600_1476312208_n.jpg" /></li>
		<li><img src="http://scontent-a.cdninstagram.com/hphotos-xaf1/t51.2885-15/10843954_1515333188725015_1392943770_n.jpg" /></li>
	</ul>
</div>


<script type="text/javascript">
function cycleImages(){
	var $active = $('#target .active');
	var $next = ($active.next().length > 0) ? $active.next() : $('#target li:first');
	$next.css('z-index',2);//move the next image up the pile
	$active.fadeOut(1500,function(){//fade out the top image
		$active.css('z-index',1).show().removeClass('active');//reset the z-index and unhide the image
		$next.css('z-index',3).addClass('active');//make the next image the top one
	});
}
</script>


<script type="text/javascript">
	$(document).ready(function() {

		var cleanTrend = '';

		// PULLING TRENDING TOPICS FROM TWITTER VIA trends.json
		// -
		// -
		// -
		$.getJSON("trends.json", function(raw) {
		// console.log(json);
		// console.log(raw.trends[0].name);
		
		$.each(raw.trends, function(key, value) {
			// console.log(key + ": " + value.name);

			var trend = value.name;
			cleanTrend = trend.replace('#', '');
			cleanTrend = cleanTrend.replace(' ', '');
			// console.log(cleanTrend);
			console.log(typeof cleanTrend);
		});


		var tag = "bmx";
			tag = "selfie";
			tag = "ICantBreathe";
			tag = cleanTrend;
		var count = 1;
		var access_token = '231040019.00106e2.b76074d997574b68a344b0a24f64bddc';
		var access_parameters = {access_token:access_token};
		var collection = ['init'];


		function grabImages(access_parameters) {
		
			var instagramUrl = 'https://api.instagram.com/v1/tags/' + tag + '/media/recent?callback=?&count='+ count;
			$.getJSON(instagramUrl, access_parameters, onDataLoaded);
		
		}

		// function onDataLoaded(access_parameters) {
		//   // instagram_data.meta is where the secret messages from Instagram live
		//   // and instagram_data.meta.code holds the status code of the request
		//   // 404 means nothing was found, and 200 means everything is all good so...

		//   if (instagram_data.meta.code == 200) {
		//     // create a variable that holds all returned payload
		//     var photos = instagram_data.data;

		//     //as long as that variable holds data (does not = ) then...

		//     if (photos.length > 0) {
		//       //since there are multiple objects in the payload we have
		//       //to create a loop
		//       for (var key in photos ) {
		//         //we create a variable for one object
		//         var photo = photos[key];
		//         //then we create and append to the DOM an  element in jQuery
		//         //the source of which is the thumbnail of the photo
		//         $('#target').append('');
		//         console.log('loaded');
		//       }
		//     } else if {
		//       //if the photos variable doesn’t hold data
		//       $('#target').append("Hmm.  I couldn’t find anything!");
		//     } else {
		//       //if we didn’t get a 200 (success) request code from instagram
		//       //then we display instagram’s error message instagram
		//       var error = data.meta.error_message;
		//       $('#target').append('Something happened, Instagram said: ' + error);
		//   	}
		//   }
		// }

		function onDataLoaded(instagram_data) {
		    
		    var target = $("#target ul");
		    
		    if (instagram_data.meta.code == 200) {

		        var photos = instagram_data.data;

		        if (photos.length > 0) {
		            // target.empty(); - Clears the loaded images...just displays 4 at a time
		            for (var key in photos) {

		                var photo = photos[key];

		                // console.log(photo.hasOwnProperty('filter'));
		                // console.log(photo); // Use to check all the properties of the photo object

		                var existingPhoto = photo.id;
		                // console.log('existingPhoto: ' + existingPhoto);

		                // var collection = [];
		                // collection.unshift(existingPhoto);
		                // console.log('collection[0]: ' + collection[0]);
		                // console.log('collection[1]: ' + collection[1]);
		                // console.log('collection[] : ' + collection);


		                if (collection[0] == existingPhoto) {
		                	// If the image being checked is the same as the existing one, keep moving
		                	// console.log('sameness');

		                } else {
		                	// console.log('newness');
		                	collection.unshift(existingPhoto);
		                	// target.append('<img src="' + photo.images.thumbnail.url + '">');
		                	target.append('<li><img src="' + photo.images.standard_resolution.url + '"></li>');
		                }

		                console.log('collection.length: ' + collection.length);
		                if (collection.length >= 2) {
		                	// console.log('LIMIT REACHED');
		                	// existingPhoto = collection.pop();
		                	// console.log('pOpper: ' + collection.pop());
		                	// var laster = $('img').last().css('border', '5px solid red');

		                	// var laster = $('img').last();
		                	// console.log('laster ' + laster);
		                	// target.prepend(laster);
		                }

		                if (collection.length >= 10) {
		                	$('li').first().remove();
		                	collection.pop();
		                }
		            }

				} else {
					target.html("nothing found");
		        }

		    } else {
		        var error = instagram_data.meta.error_message;
		        target.html(error);
		    }
		}

		// grabImages(access_parameters);

		setInterval(function() {
			grabImages(access_parameters);
		}, 2000);
		setInterval(function() {
			cycleImages();
		}, 4000);
		// setInterval(function() {
		// 	// if ($("img:not(.active)")) {
		// 	if ($('.active').length > 0) {
		// 		console.log('not active');
		// 		$('img').first().addClass('active');
		// 	}
		// }, 5500);

		// console.log('cleanTrend: ' + cleanTrend);
	});


	});
</script>

</body>
</html>