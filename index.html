<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Instagram - Cycling through #bmx</title>
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js">
		</script>
		<!-- <link rel="stylesheet" type="text/css" href="http://reset5.googlecode.com/hg/reset.min.css"> -->
	</head>
<body>



<div id="target"></div>


<script type="text/javascript">
	$(document).ready(function() {
		var tag = "bmx";
		var count = 1;
		var access_token = '231040019.00106e2.b76074d997574b68a344b0a24f64bddc';
		var access_parameters = {access_token:access_token};
		var collection = ['init'];

		function grabImages(access_parameters) {
		
			var instagramUrl = 'https://api.instagram.com/v1/tags/' + tag + '/media/recent?callback=?&count='+ count;
			// var instagramUrl = 'https://api.instagram.com/v1/tags/cat/media/recent?callback=?&count='+ count;
			$.getJSON(instagramUrl, access_parameters, onDataLoaded);
		
		}

		// function onDataLoaded(access_parameters) {
		//   // instagram_data.meta is where the secret messages from Instagram live
		//   // and instagram_data.meta.code holds the status code of the request
		//   // 404 means nothing was found, and 200 means everything is all good so...

		//   if (instagram_data.meta.code == 200) {
		//     // create a variable that holds all returned payload
		//     var photos = instagram_data.data;

		//     //as long as that variable holds data (does not = ) then...

		//     if (photos.length > 0) {
		//       //since there are multiple objects in the payload we have
		//       //to create a loop
		//       for (var key in photos ) {
		//         //we create a variable for one object
		//         var photo = photos[key];
		//         //then we create and append to the DOM an  element in jQuery
		//         //the source of which is the thumbnail of the photo
		//         $('#target').append('');
		//         console.log('loaded');
		//       }
		//     } else if {
		//       //if the photos variable doesn’t hold data
		//       $('#target').append("Hmm.  I couldn’t find anything!");
		//     } else {
		//       //if we didn’t get a 200 (success) request code from instagram
		//       //then we display instagram’s error message instagram
		//       var error = data.meta.error_message;
		//       $('#target').append('Something happened, Instagram said: ' + error);
		//   	}
		//   }
		// }

		function onDataLoaded(instagram_data) {
		    
		    var target = $("#target");
		    // var collection = ['init'];
		    // console.log('instagram_data: ' + instagram_data);

		    
		    if (instagram_data.meta.code == 200) {

		        var photos = instagram_data.data;

		        if (photos.length > 0) {
		            // target.empty(); - Clears the loaded images...just displays 4 at a time
		            for (var key in photos) {

		                var photo = photos[key];

		                // console.log(photo.hasOwnProperty('filter'));
		                // console.log(photo); // Use to check all the properties of the photo object
		                // console.log('photo.id: ' + photo.id);

		                var existingPhoto = photo.id;
		                console.log('existingPhoto: ' + existingPhoto);

		                // var collection = [];
		                // collection.unshift(existingPhoto);
		                console.log('collection[0]: ' + collection[0]);
		                console.log('collection[1]: ' + collection[1]);
		                // console.log('collection[] : ' + collection);


		                if (collection[0] == existingPhoto) {
		                	// If the image being checked is the same as the existing one, keep moving
		                	// console.log('sameness');

		                } else {
		                	console.log('newness');
		                	collection.unshift(existingPhoto);
		                	target.prepend('<img src="' + photo.images.thumbnail.url + '">');
		                }

		                console.log('collection.length: ' + collection.length);
		                if (collection.length >= 2) {
		                	// console.log('LIMIT REACHED');
		                	// existingPhoto = collection.pop();
		                	// console.log('pOpper: ' + collection.pop());
		                	// var laster = $('img').last().css('border', '5px solid red');
		                	var laster = $('img').last();
		                	console.log('laster ' + laster);
		                	target.prepend(laster);
		                }

		                if (collection.length >= 12) {
		                	$('img').last().remove();
		                	collection.pop();
		                }

		                console.log('');



		                // target.prepend('<a href="' + photo.link + '"><img src="' + photo.images.thumbnail.url + '"></a>')
		            }

				} else {
					target.html("nothing found");
		        }

		    } else {
		        var error = instagram_data.meta.error_message;
		        target.html(error);
		    }
		}

		// grabImages(access_parameters);

		setInterval(function() {
			grabImages(access_parameters);
		}, 1500);


	});
</script>

</body>
</html>